# File YAML untuk konfigurasi workflow CI/CD aplikasi Karsajobs frontend pada CircleCI
# untuk assignment Dicoding 2 - Membangun Arsitektur Microservices dengan Kubernetes
# Nama siswa: Lonard Steven - Jakarta

version: 2.1              # Menetapkan versi YML dari file konfigurasi YML

jobs:                                                                       # Definisi job yang akan dilakukan pada CircleCI
  lint-dockerfile:                                                          # Job 1 - lint-dockerfile: Menginstal Hadolint dan menggunakannya pada Dockerfile frontend
    docker:
      - image: hadolint/hadolint
    steps: 
      - run: docker pull hadolint/hadolint:latest-debian                    # Download image Hadolint
      - run: hadolint Dockerfile                                            # Pakai Hadolint untuk Dockerfile di repositori terkait
  build-app-karsajobs-ui:                                                   # Job 2 - build-app-karsajobs-ui: Menjalankan file script untuk build dan push image
    docker:
      - image: cimg/base:2023.11
    steps:
    - run: sh build_push_image_karsajobs_ui.sh

workflows:                                                                  # Alur kerja/workflow dari proses CI/CD yang dilakukan CircleCI, yakni:
  karsajobs-ui-cicd:
    jobs:
      - lint-dockerfile                                                     # Melakukan job 1 (lint-dockerfile) pertama-tama, dan
      - build-app-karsajobs-ui:                                             # Melakukan job 2 (build-app-karsajobs-ui) setelah job lint-dockerfile selesai dilakukan (dan berhasil)
          requires:
            - lint-dockerfile